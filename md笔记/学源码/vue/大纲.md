# vue2源码学习

## 学习资料

<https://github.com/answershuto/learnVue>

## 大纲

### 1. 响应式原理

1. 主要是同个Object.defineProperty的get和set，来实现数据的响应。
   1. get时，收集依赖的数据，返回数据结果。
   2. set时触发订阅者的update
   3. 组件

```javascript
class Vue {
    constructor(options) {
        this._data = options.data;
        observe(this._data, options.render)
    }
}
```

```javascript
Object.defineProperty(obj, key, {
  enumerable: true,
  configurable: true,
  get: ()=>{
      /*....依赖收集等....*/
      return val
  },
  set:newVal=> {
      val = newVal;
      cb();/*订阅者收到消息的回调*/
  }
})
```

### 2.依赖收集

```javascript
class Dep {
    constructor () {
        this.subs = [];
    }

    addSub (sub: Watcher) {
        this.subs.push(sub)
    }

    removeSub (sub: Watcher) {
        remove(this.subs, sub)
    }
    /*Github:https://github.com/answershuto*/
    notify () {
        // stabilize the subscriber list first
        const subs = this.subs.slice()
        for (let i = 0, l = subs.length; i < l; i++) {
            subs[i].update()
        }
    }
}
function remove (arr, item) {
    if (arr.length) {
        const index = arr.indexOf(item)
        if (index > -1) {
            return arr.splice(index, 1)
        }
    }
}
```

## TODO

- 响应式原理
  - 组件的data和computed的依赖收集关系
- nextTick 的实现, 是微任务还是宏任务。
- 计算属性的实现
- vue的数据绑定前后分析，和各个任务触发的时机。
  - set,get
  - 依赖收集
  - 数据更新
  - 是同步还是异步
  - 多个数据同时更新，VUE怎么处理的
- DOM差异分析因素，和react的实现有什么区别
  - 怎么能最小限度的更新DOM
  - 怎么让页面刷新，但是vue组件不刷新，列一下实现办法
    - 函数组件，保持state不变
    - 静态组件
    - 。。。
  - 列一下强制刷新组件的方式（state变化和不变）（依赖收集）
    - 绑定key
  - 那些state变化会引起组件的刷新，那些不会（依赖收集）
- vue中存在哪些异步处理功能，怎么实现的
- vueX的实现原理
  - 生命一个新的VUE实例，通过注入组件内

- react的数据绑定实现，和VUE的区别
- setState干了什么
- react中存在哪些异步处理功能，怎么实现的.和VUE对比一下。
- react的diff影响因素