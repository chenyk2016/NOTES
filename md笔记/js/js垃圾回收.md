# js垃圾回收

## GC介绍
GC是Garbage Collection的缩写，意为垃圾回收

### 引用计数算法

记录对象被引用多少次。

优势:
  - 可即刻回收垃圾，当被引用数值为0时，对象马上会把自己作为空闲空间连到空闲链表上，也就是说。在变成垃圾的时候就立刻被回收。
  - 因为是即时回收,那么‘程序’不会暂停去单独使用很长一段时间的GC，那么最大暂停时间很短。
  - 不用去遍历堆里面的所有活动对象和非活动对象

劣势:
  - 计数器需要占很大的位置，因为不能预估被引用的上限，打个比方，可能出现32位即2的32次方个对象同时引用一个对象，那么计数器就需要32位。
  - 最大的劣势是无法解决循环引用无法回收的问题 这就是前文中IE9之前出现的问题

#### IE9之前的问题

我们知道，IE中有一部分对象并不是原生js对象。例如，其内存泄露DOM和BOM中的对象就是使用C++以COM对象的形式实现的，而COM对象的垃圾回收机制采用的就是引用计数策略。因此，即使IE的js引擎采用标记清除策略来实现，但js访问的COM对象依然是基于引用计数策略的。换句话说，只要在IE中涉及COM对象，就会存在循环引用的问题。

```js
window.onload = function (){
  var obj = document.getElementById("element");
  obj.onclick=function innerFunction(){};
};
```

### 标记清除算法

主要将GC的垃圾回收过程分为两个阶段

标记阶段：把所有活动对象做上标记。
清除阶段：把没有标记（也就是非活动对象）销毁。
